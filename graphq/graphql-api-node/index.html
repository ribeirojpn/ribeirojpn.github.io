<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Introdução ao GraphQL com Node.js · RibeiroJPN</title><meta name="description" content="Introdução ao GraphQL com Node.js - Joao Paulo Ribeiro"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><h1 class="nav-title">RibeiroJPN</h1></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/ribeirojpn" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://twitter.com/ribeirojpn" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Introdução ao GraphQL com Node.js</h1><div class="post-info">Jun 17, 2016</div><div class="post-content"><p>GraphQL é uma linguagem de consulta de dados desenvolvida e usado pelo Facebook para realizar requisições e entregar informações para aplicações web e mobile desde 2012. GraphQL facilita o processo de entregar ao client apenas o que foi requisitado pelo mesmo e na ordem em que foi requisitado.</p>
<p><em>Exemplo</em>:</p>
<p>Se temos um objeto <code>User</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	<span class="string">"name"</span>: <span class="string">"Joao"</span>,</div><div class="line">	<span class="string">"full_name"</span>: <span class="string">"Joao Paulo"</span>,</div><div class="line">	<span class="string">"age"</span>: <span class="number">22</span>,</div><div class="line">	<span class="string">"city"</span>: <span class="string">"Campina Grande"</span>,</div><div class="line">	<span class="string">"tag"</span>: <span class="string">"ribeirojpn"</span>,</div><div class="line">	<span class="string">"url"</span>: <span class="string">"https://twitter.com/ribeirojpn"</span>,</div><div class="line">	<span class="string">"knowledge"</span>: [</div><div class="line">		&#123;</div><div class="line">			<span class="string">"language"</span>: <span class="string">"Javascript"</span>,</div><div class="line">			<span class="string">"frameworks"</span>: [<span class="string">"express.js"</span>, <span class="string">"hapi.js"</span>, <span class="string">"AngularJS"</span>]</div><div class="line">		&#125;,</div><div class="line">		&#123;</div><div class="line">			<span class="string">"language"</span>: <span class="string">"Java"</span>,</div><div class="line">			<span class="string">"frameworks"</span>: [<span class="string">"Play"</span>]</div><div class="line">		&#125;,</div><div class="line">		&#123;</div><div class="line">			<span class="string">"language"</span>: <span class="string">"Python"</span>,</div><div class="line">			<span class="string">"frameworks"</span>: []</div><div class="line">		&#125;</div><div class="line">	]</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure></p>
<p>Podemos solicitar apenas os dados <code>name</code>, <code>age</code>, <code>city</code> e as linguagens que o usuário possui conhecimento(<code>knowledge.language</code>) ao fazer a seguinte requisição para o servidor:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">query &#123;</div><div class="line">	user(name:<span class="string">"Joao"</span>) &#123;</div><div class="line">		name</div><div class="line">		age</div><div class="line">		city</div><div class="line">		knowledge &#123;</div><div class="line">			language</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Retornando:</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"data"</span>: &#123;</div><div class="line">    <span class="string">"user"</span>: &#123;</div><div class="line">      <span class="string">"name"</span>: <span class="string">"Joao"</span>,</div><div class="line">      <span class="string">"age"</span>: <span class="number">22</span>,</div><div class="line">      <span class="string">"city"</span>: <span class="string">"Campina Grande"</span>,</div><div class="line">      <span class="string">"knowledge"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Javascript"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Java"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Python"</span></div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Se eu também quiser que retorne os frameworks basta adicionar <code>frameworks</code> dentro do bloco de <code>knowledge</code>, ficando assim:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">query &#123;</div><div class="line">	user(name:<span class="string">"Joao"</span>) &#123;</div><div class="line">		name</div><div class="line">		age</div><div class="line">		city</div><div class="line">		knowledge &#123;</div><div class="line">			language</div><div class="line">			frameworks</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Retornando:</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"data"</span>: &#123;</div><div class="line">    <span class="string">"user"</span>: &#123;</div><div class="line">      <span class="string">"name"</span>: <span class="string">"Joao"</span>,</div><div class="line">      <span class="string">"age"</span>: <span class="number">22</span>,</div><div class="line">      <span class="string">"city"</span>: <span class="string">"Campina Grande"</span>,</div><div class="line">      <span class="string">"knowledge"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Javascript"</span>,</div><div class="line">          <span class="string">"frameworks"</span>: [<span class="string">"express.js"</span>,<span class="string">"hapi.js"</span>,<span class="string">"AngularJS"</span>]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Java"</span>,</div><div class="line">          <span class="string">"frameworks"</span>: [<span class="string">"Play"</span>]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Python"</span>,</div><div class="line">          <span class="string">"frameworks"</span>: []</div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Essas requisições podem ser feitas pelo client utilizando o método <code>GET</code>, a url da requisição na rota <code>/graphql</code> do exemplo acima seria igual a:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/graphql?query=&#123;user(name:<span class="string">"user"</span>)&#123;name,age,city,knowledge&#123;language,frameworks&#125;&#125;&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>OBS</strong>: GraphQL ainda é uma novidade e não achei muito sobre boas praticas. Assim que ficar sabendo mais a respeito, postarei aqui. ^^</p>
</blockquote>
<h2 id="Usando-GraphQL-no-Node-js"><a href="#Usando-GraphQL-no-Node-js" class="headerlink" title="Usando GraphQL no Node.js"></a>Usando GraphQL no Node.js</h2><p>Vamos usar o <a href="https://github.com/graphql/graphql-js" target="_blank" rel="external">graphql-js</a> e o <a href="https://github.com/graphql/express-graphql" target="_blank" rel="external">express-graphql</a> para criarmos uma ‘mini-API’.</p>
<ul>
<li>graphql-js é a implementação do GraphQL no javascript</li>
<li>express-graphql é um middleware que costumiza o sevidor HTTP do express para ter suporte ao estilo do GraphQL</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm init</div><div class="line">$ npm install express graphql express-graphql --save</div></pre></td></tr></table></figure>
<p>Usaremos os dados abaixo em um arquivo chamado <code>users.json</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">	&#123;</div><div class="line">		<span class="string">"id"</span>:<span class="number">1</span>,</div><div class="line">		<span class="string">"name"</span>: <span class="string">"Joao"</span>,</div><div class="line">		<span class="string">"age"</span>: <span class="number">22</span>,</div><div class="line">		<span class="string">"knowledge"</span>: [</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Javascript"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: [<span class="string">"express.js"</span>, <span class="string">"hapi.js"</span>, <span class="string">"AngularJS"</span>]</div><div class="line">			&#125;,</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Java"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: [<span class="string">"Play"</span>]</div><div class="line">			&#125;,</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Python"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: []</div><div class="line">			&#125;</div><div class="line">		]</div><div class="line">	&#125;,</div><div class="line">	&#123;</div><div class="line">		<span class="string">"id"</span>:<span class="number">2</span>,</div><div class="line">		<span class="string">"name"</span>: <span class="string">"Maria"</span>,</div><div class="line">		<span class="string">"age"</span>: <span class="number">20</span>,</div><div class="line">		<span class="string">"knowledge"</span>: [</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Javascript"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: [<span class="string">"ReactJS"</span>, <span class="string">"AngularJS"</span>]</div><div class="line">			&#125;,</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Java"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: [<span class="string">"Play"</span>, <span class="string">"Spring"</span>]</div><div class="line">			&#125;,</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Python"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: [<span class="string">"Django"</span>]</div><div class="line">			&#125;</div><div class="line">		]</div><div class="line">	&#125;,</div><div class="line">	&#123;</div><div class="line">		<span class="string">"id"</span>:<span class="number">3</span>,</div><div class="line">		<span class="string">"name"</span>: <span class="string">"Ana"</span>,</div><div class="line">		<span class="string">"age"</span>: <span class="number">20</span>,</div><div class="line">		<span class="string">"knowledge"</span>: [</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Javascript"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: [<span class="string">"ReactJS"</span>, <span class="string">"express.js"</span>]</div><div class="line">			&#125;,</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Ruby"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: [<span class="string">"Ruby on Rails"</span>]</div><div class="line">			&#125;,</div><div class="line">			&#123;</div><div class="line">				<span class="string">"language"</span>: <span class="string">"Python"</span>,</div><div class="line">				<span class="string">"frameworks"</span>: [<span class="string">"Django"</span>]</div><div class="line">			&#125;</div><div class="line">		]</div><div class="line">	&#125;</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>Criaremos um arquivo chamado <code>schema.js</code> com o seguinte código:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> graphql = <span class="built_in">require</span>(<span class="string">'graphql'</span>)</div><div class="line"><span class="keyword">const</span> users = <span class="built_in">require</span>(<span class="string">'./user.json'</span>)</div><div class="line"></div><div class="line"><span class="keyword">let</span> knowledgeType = <span class="keyword">new</span> graphql.GraphQLObjectType(&#123;</div><div class="line">  name:<span class="string">'Knowledge'</span>,</div><div class="line">  fields: &#123;</div><div class="line">		language: &#123; type: graphql.GraphQLString &#125;,</div><div class="line">		frameworks: &#123; type: <span class="keyword">new</span> graphql.GraphQLList(graphql.GraphQLString ) &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">let</span> userType = <span class="keyword">new</span> graphql.GraphQLObjectType(&#123;</div><div class="line">  name: <span class="string">'User'</span>,</div><div class="line">	fields: &#123;</div><div class="line">		id: &#123; type: <span class="keyword">new</span> graphql.GraphQLNonNull(graphql.GraphQLInt) &#125;,</div><div class="line">		name: &#123; type: <span class="keyword">new</span> graphql.GraphQLNonNull(graphql.GraphQLString) &#125;,</div><div class="line">		full_name: &#123; type: graphql.GraphQLString &#125;,</div><div class="line">		age: &#123; type: graphql.GraphQLInt &#125;,</div><div class="line">		city: &#123; type: graphql.GraphQLString &#125;,</div><div class="line">		tag: &#123; type: graphql.GraphQLString &#125;,</div><div class="line">		url: &#123; type: graphql.GraphQLString &#125;,</div><div class="line">		knowledge: &#123; type: <span class="keyword">new</span> graphql.GraphQLList(knowledgeType) &#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">let</span> schema = <span class="keyword">new</span> graphql.GraphQLSchema(&#123;</div><div class="line">	query: <span class="keyword">new</span> graphql.GraphQLObjectType(&#123;</div><div class="line">    name: <span class="string">'Query'</span>,</div><div class="line">    fields: &#123;</div><div class="line">		  user: &#123;</div><div class="line">				type: userType,</div><div class="line">      	args: &#123;</div><div class="line">          id:&#123;</div><div class="line">            type: graphql.GraphQLInt</div><div class="line">          &#125;</div><div class="line">        &#125;,</div><div class="line">        resolve: <span class="function"><span class="keyword">function</span> (<span class="params">_ , args</span>) </span>&#123;</div><div class="line">					<span class="keyword">let</span> response = users.find(<span class="function"><span class="keyword">function</span> (<span class="params">user</span>)</span>&#123;</div><div class="line">						<span class="keyword">return</span> (user.id === args.id)</div><div class="line">					&#125;)</div><div class="line">          <span class="keyword">return</span> response</div><div class="line">        &#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = schema</div></pre></td></tr></table></figure>
<p>No código acima criamos dois <a href="http://graphql.org/docs/api-reference-type-system/#graphqlobjecttype" target="_blank" rel="external"><code>GraphQLObjectType</code></a> chamados de <code>userType</code> e <code>knowledgeType</code>, eles funcionam como ‘models’ para o <code>schema</code>. Precisamos criar um tipo especifico para ‘knowledge’ para que possamos solicitar apenas parte dos dados desse campo, como no exemplo anterior.</p>
<p>O <code>schema</code> é um objeto do tipo <a href="http://graphql.org/docs/api-reference-type-system/#graphqlschema" target="_blank" rel="external"><code>GraphQLSchema</code></a> que recebe um <code>GraphQLObjectType</code> com as propriedades <code>name</code> e <code>fields</code>. Em <code>fields</code> ficam os métodos que serão usados na query. No nosso caso, temos <code>user</code> que vai usar o <code>userType</code> passado na propriedade <code>type</code> como tipo de dado a ser manipulado e em <code>args</code> passamos os argumentos que este método deve receber para realizar a operação como propriedades que recebem de qual tipo esse argumento será, no caso acima temos o argumento <code>id</code> que será do tipo <code>int</code>. A propriedade <code>resolve</code> de <code>user</code> recebe uma função, está função será responsável por buscar e retornar o usuário que possui a <code>id</code> passada como argumento.</p>
<p>Agora, criaremos o arquivo <code>index.js</code> onde iniciaremos o servidor e determinaremos a rota que usará o <code>schema</code> que acabamos de criar. O código de <code>index.js</code> será este:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> graphql = <span class="built_in">require</span>(<span class="string">'graphql'</span>)</div><div class="line"><span class="keyword">const</span> graphqlHTTP = <span class="built_in">require</span>(<span class="string">'express-graphql'</span>)</div><div class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> users = <span class="built_in">require</span>(<span class="string">'./schema'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/user'</span>, graphqlHTTP(&#123;schema:users, pretty: <span class="literal">true</span>&#125;))</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Server on.'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Aqui iniciamos o servidor com express na porta <code>3000</code> e criamos uma rota para <code>/user</code> passando a função <code>graphqlHTTP({schema:users, pretty: true})</code><br>para ser chamado sempre que for realizada uma requisição nessa rota. Foi passado um objeto com a propriedade <code>schema</code> com o schema que criamos em <code>schema.js</code> como valor dessa propriedade. Essa função se responsabiliza por verificar a requisição e executar a <code>resolve</code> referente a propriedade passada na requisição.</p>
<p>Inicie o servidor no seu terminal:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node index.js</div></pre></td></tr></table></figure></p>
<p>E acesse a seguinte url no seu browser:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:3000/user?query=&#123;user(id:2)&#123;id,name,age,knowledge&#123;language,frameworks&#125;&#125;&#125;</div></pre></td></tr></table></figure>
<p>Você deve receber isso:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"data"</span>: &#123;</div><div class="line">    <span class="string">"user"</span>: &#123;</div><div class="line">      <span class="string">"id"</span>: <span class="number">2</span>,</div><div class="line">      <span class="string">"name"</span>: <span class="string">"Maria"</span>,</div><div class="line">      <span class="string">"age"</span>: <span class="number">20</span>,</div><div class="line">      <span class="string">"knowledge"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Javascript"</span>,</div><div class="line">          <span class="string">"frameworks"</span>: [</div><div class="line">            <span class="string">"ReactJS"</span>,</div><div class="line">            <span class="string">"AngularJS"</span></div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Java"</span>,</div><div class="line">          <span class="string">"frameworks"</span>: [</div><div class="line">            <span class="string">"Play"</span>,</div><div class="line">            <span class="string">"Spring"</span></div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="string">"language"</span>: <span class="string">"Python"</span>,</div><div class="line">          <span class="string">"frameworks"</span>: [</div><div class="line">            <span class="string">"Django"</span></div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Experimente variar as propriedades solicitadas e veja o que retorna:<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">http://localhost:<span class="number">3000</span>/user?query=&#123;user(id:<span class="number">2</span>)&#123;id,name,age,knowledge&#123;language,frameworks&#125;&#125;&#125;</div><div class="line">http://localhost:<span class="number">3000</span>/user?query=&#123;user(id:<span class="number">3</span>)&#123;id,name,age,knowledge&#123;language&#125;&#125;&#125;</div><div class="line">http://localhost:<span class="number">3000</span>/user?query=&#123;user(id:<span class="number">1</span>)&#123;id,knowledge&#123;language,frameworks&#125;&#125;&#125;</div><div class="line">http://localhost:<span class="number">3000</span>/user?query=&#123;user(id:<span class="number">1</span>)&#123;id,name,age&#125;&#125;</div><div class="line">http://localhost:<span class="number">3000</span>/user?query=&#123;user(id:<span class="number">2</span>)&#123;id,name,age,knowledge&#123;&#125;&#125;&#125;</div></pre></td></tr></table></figure></p>
<p>A Propriedade <code>query</code> em <code>schema</code> recebe em <code>fields</code> os métodos que serão chamados em requisições <code>GET</code>, como no nosso caso <code>user</code> que ira retornar o usuário através da função declarada na propriedade de <code>user</code> chamada <code>resolve</code>.</p>
<p>Mas e pra retornar a lista com todos os usuários? Simples, basta adicionarmos o código abaixo como outra propriedade de <code>fields</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">users: &#123;</div><div class="line">	type: <span class="keyword">new</span> graphql.GraphQLList(userType),</div><div class="line">	resolve: <span class="function"><span class="keyword">function</span> (<span class="params">_ , args</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> users</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Assim passamos a ter dois métodos de query no schema, <code>user</code> que retorna o usuário com a id passada como argumento e <code>users</code> que retorna a lista com todos os usuários. Experimente:</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:<span class="number">3000</span>/user?query=&#123;users&#123;id,name,age,knowledge&#123;language,frameworks&#125;&#125;&#125;</div></pre></td></tr></table></figure>
<p>Essa url tem uma query no seguinte formato:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">query &#123;</div><div class="line">	users &#123;</div><div class="line">		id</div><div class="line">		name</div><div class="line">		age</div><div class="line">		knowledge &#123;</div><div class="line">			language</div><div class="line">			frameworks</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Ficou faltando falar de criar, atualizar e deletar dados, certo? não se preocupe, farei outro post falando sobre isso porque este já ficou bem extenso. Até mais!</p>
<p><strong>Fontes:</strong></p>
<ul>
<li><a href="http://graphql.org/" target="_blank" rel="external">http://graphql.org/</a></li>
<li><a href="https://code.facebook.com/posts/1691455094417024/graphql-a-data-query-language/" target="_blank" rel="external">https://code.facebook.com/posts/1691455094417024/graphql-a-data-query-language/</a></li>
</ul>
</div><div class="tags"><a href="/tags/api/">api</a><a href="/tags/nodejs/">nodejs</a></div></article></div></section><footer><div class="paginator"><a href="/uncategorized/weeklies-and-podcasts/" class="prev">PREV</a><a href="/java/json-web-token-play/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ribeirojpn';
var disqus_identifier = 'graphq/graphql-api-node/';
var disqus_title = 'Introdução ao GraphQL com Node.js';
var disqus_url = 'http://ribeirojpn.github.io/graphq/graphql-api-node/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ribeirojpn.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 <a href="http://ribeirojpn.github.io">Joao Paulo Ribeiro</a>. Powered by <a href="https://hexo.io/">Hexo</a>. Theme by <a href="https://github.com/pinggod/hexo-theme-apollo">pinggod</a> and customized by <a href="https://github.com/ribeirojpn/hexo-theme-apollo">RibeiroJPN</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80318173-1",'auto');ga('send','pageview');</script></body></html>